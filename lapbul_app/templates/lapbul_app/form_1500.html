{% include 'lapbul_app/header.html' %}
<style>
  /* CSS for form alignment and styling */
  .form-container {
    display: flex;
    justify-content: center;
  }
  .table-responsive {
    margin: 0 auto;
  }

  /* Define the sticky column styles for both th and td */
  .sticky-action-col {
    position: sticky;
    right: 0;
    background-color: rgba(255, 255, 255, 0.95) !important;
    z-index: 10; /* Increased z-index to ensure visibility over other elements */
    box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
    text-align: center;
    min-width: 120px;
  }

  /* Ensure sticky header works in table */
  table.dataTable thead th.sticky-action-col {
    z-index: 15; /* Higher z-index for header to stay above body cells */
    position: sticky;
    right: 0;
  }

  /* CSS untuk center kolom tertentu */
  table td:nth-child(1),
  table th:nth-child(1) {
    text-align: center;
    vertical-align: middle;
  }

  .form-select.w-auto {
    max-width: fit-content;
  }

  table td input.form-control {
    text-align: right;
  }
</style>

<div id="layoutSidenav_content">
  <main>
    <div class="container-fluid px-4">
      <h5 class="mt-4">Form 1500 - Daftar Aset Produktif yang Dihapus Buku</h5>
      <hr />
      <!-- Button to trigger modal -->
      <a href="{% url 'lapbul_app:lapbul' %}" class="btn btn-secondary"
        >Kembali</a
      >
      <!-- Filter Kantor -->
      <div class="mb-3 d-flex align-items-center gap-2">
        <label for="kantorFilter" class="form-label mb-0"
          >Pilih Sandi Kantor:</label
        >
        <select
          id="kantorFilter"
          class="form-select form-select-sm w-auto"
          onchange="filterKantor()"
        >
          <option value="all">semua</option>
          <option value="001">001</option>
          <option value="002">002</option>
        </select>
      </div>

      <!-- Modal structure -->
      <div
        class="modal fade"
        id="form1500Modal"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="form1500ModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header bg-secondary">
              <h6 class="modal-title text-white" id="form1500ModalLabel">
                Form Input Daftar Aset Produktif yang Dihapus Buku
              </h6>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Tutup"
              ></button>
            </div>

            <div class="modal-body">
              <!-- Input Form -->
              <form>
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label for="sandi_kantor" class="form-label"
                      >Sandi Kantor</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="sandi_kantor"
                      name="sandi_kantor"
                      maxlength="3"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="id_pihak_lawan" class="form-label"
                      >ID Pihak Lawan</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="id_pihak_lawan"
                      name="id_pihak_lawan"
                      maxlength="20"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="no_rekening" class="form-label"
                      >No. Rekening</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="no_rekening"
                      name="no_rekening"
                      maxlength="20"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="jenis" class="form-label">Jenis</label>
                    <input
                      type="text"
                      class="form-control"
                      id="jenis"
                      name="jenis"
                      maxlength="2"
                    />
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label for="gol_debitur" class="form-label"
                      >Gol. Debitur</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="gol_debitur"
                      name="gol_debitur"
                      maxlength="3"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="hubungan_bank" class="form-label"
                      >Hubungan dengan Bank</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="hubungan_bank"
                      name="hubungan_bank"
                      maxlength="1"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="tgl_hapus_buku" class="form-label"
                      >Tanggal Hapus Buku</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="tgl_hapus_buku"
                      name="tgl_hapus_buku"
                      maxlength="8"
                      placeholder="YYYYMMDD"
                    />
                  </div>
                </div>

                <!-- Saldo Pokok -->
                <h6 class="mt-4 border-bottom pb-2">Saldo Pokok</h6>
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="saldo_pokok_hapus" class="form-label"
                      >Saat Hapus Buku</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="saldo_pokok_hapus"
                      name="saldo_pokok_hapus"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="saldo_pokok_tertagih" class="form-label"
                      >Akumulasi Tertagih</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="saldo_pokok_tertagih"
                      name="saldo_pokok_tertagih"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="saldo_pokok_laporan" class="form-label"
                      >Per Posisi Laporan</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="saldo_pokok_laporan"
                      name="saldo_pokok_laporan"
                    />
                  </div>
                </div>

                <!-- Tunggakan Bunga -->
                <h6 class="mt-4 border-bottom pb-2">Tunggakan Bunga</h6>
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="tunggakan_hapus" class="form-label label-fixed">
                      Saat Hapus Buku
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="tunggakan_hapus"
                      name="tunggakan_hapus"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label
                      for="tunggakan_tertagih"
                      class="form-label label-fixed"
                    >
                      Akumulasi Tertagih
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="tunggakan_tertagih"
                      name="tunggakan_tertagih"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label
                      for="tunggakan_tambahan"
                      class="form-label label-fixed"
                    >
                      Akumulasi Tambahan <br />Bunga Berjalan
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="tunggakan_tambahan"
                      name="tunggakan_tambahan"
                    />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label
                      for="tunggakan_laporan"
                      class="form-label label-fixed"
                    >
                      Per Posisi Laporan
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="tunggakan_laporan"
                      name="tunggakan_laporan"
                    />
                  </div>
                </div>

                <style>
                  /* Biar semua label punya tinggi yang sama */
                  .label-fixed {
                    display: block;
                    min-height: 3em; /* samakan tinggi label */
                    line-height: 1.2;
                    white-space: normal; /* biar bisa turun baris */
                  }
                </style>

                <!-- Agunan -->
                <h6 class="mt-4 border-bottom pb-2">Agunan</h6>
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="agunan_jenis" class="form-label">Jenis</label>
                    <input
                      type="text"
                      class="form-control"
                      id="agunan_jenis"
                      name="agunan_jenis"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="agunan_alamat" class="form-label">Alamat</label>
                    <input
                      type="text"
                      class="form-control"
                      id="agunan_alamat"
                      name="agunan_alamat"
                    />
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="agunan_nilai" class="form-label">Nilai</label>
                    <input
                      type="text"
                      class="form-control"
                      id="agunan_nilai"
                      name="agunan_nilai"
                    />
                  </div>
                </div>
              </form>
              <!-- End Input Form -->
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Tutup
              </button>
              <button type="button" class="btn btn-primary">Simpan</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="form-container">
        <div class="table-responsive">
          <table
            id="datatables"
            class="table table-bordered table-sm nowrap w-100"
          >
            <thead>
              <tr class="text-center align-middle">
                <th rowspan="2" class="align-middle">Sandi Kantor</th>
                <th rowspan="2" class="align-middle">ID Pihak Lawan</th>
                <th rowspan="2" class="align-middle">No. Rekening</th>
                <th rowspan="2" class="text-center">Jenis</th>
                <th rowspan="2" class="align-middle text-center">
                  Gol. Debitur
                </th>
                <th rowspan="2" class="align-middle">Hubungan dengan Bank</th>
                <th rowspan="2" class="align-middle">Tanggal Hapus Buku</th>
                <th colspan="3" class="text-center align-middle">
                  Saldo Pokok
                </th>
                <th colspan="4" class="text-center align-middle">
                  Tunggakan Bunga
                </th>
                <th colspan="3" class="text-center align-middle">Agunan</th>
                <th rowspan="2" class="sticky-action-col text-center">Aksi</th>
              </tr>
              <tr class="text-center align-middle">
                <!-- Sub Kolom Saldo Pokok -->
                <th>Saat Hapus Buku</th>
                <th>Akumulasi Tertagih</th>
                <th>Per Posisi Laporan</th>
                <!-- Sub Kolom Tunggakan Bunga -->
                <th>Saat Hapus Buku</th>
                <th>Akumulasi Tertagih</th>
                <th>Akumulasi Tambahan Bunga Berjalan</th>
                <th>Per Posisi Laporan</th>
                <!-- Sub Kolom Agunan -->
                <th class="text-center">Jenis</th>
                <th>Alamat</th>
                <th>Nilai</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>001</td>
                <td>CIF1</td>
                <td>Rekening1</td>
                <td>10 (Kredit yang diberikan)</td>
                <td>835 (Lainnya)</td>
                <td>12 (Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 1</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>001</td>
                <td>CIF2</td>
                <td>Rekening2</td>
                <td>20 (Penempatan pada bank lain)</td>
                <td>600 (BPR Konvensional)</td>
                <td>20 (Tidak Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 2</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>001</td>
                <td>CIF3</td>
                <td>Rekening3</td>
                <td>10 (Kredit yang diberikan)</td>
                <td>835 (Lainnya)</td>
                <td>12 (Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 3</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>001</td>
                <td>CIF4</td>
                <td>Rekening4</td>
                <td>20 (Penempatan pada bank lain)</td>
                <td>601 (BPR Syariah)</td>
                <td>20 (Tidak Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 4</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>001</td>
                <td>CIF5</td>
                <td>Rekening5</td>
                <td>10 (Kredit yang diberikan)</td>
                <td>835 (Lainnya)</td>
                <td>12 (Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 5</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>002</td>
                <td>CIF6</td>
                <td>Rekening6</td>
                <td>20 (Penempatan pada bank lain)</td>
                <td>700 (Bank Umum Konvensional)</td>
                <td>20 (Tidak Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 6</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>002</td>
                <td>CIF7</td>
                <td>Rekening7</td>
                <td>10 (Kredit yang diberikan)</td>
                <td>835 (Lainnya)</td>
                <td>12 (Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 7</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>002</td>
                <td>CIF8</td>
                <td>Rekening8</td>
                <td>20 (Penempatan pada bank lain)</td>
                <td>700 (Bank Umum Konvensional)</td>
                <td>20 (Tidak Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 8</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>002</td>
                <td>CIF9</td>
                <td>Rekening9</td>
                <td>10 (Kredit yang diberikan)</td>
                <td>835 (Lainnya)</td>
                <td>12 (Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 9</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
              <tr>
                <td>002</td>
                <td>CIF10</td>
                <td>Rekening10</td>
                <td>20 (Penempatan pada bank lain)</td>
                <td>
                  901 (Unit Usaha Syariah (KC Syariah Bank Umum Konvensional))
                </td>
                <td>20 (Tidak Terkait)</td>
                <td>20180101</td>
                <td>100.000</td>
                <td>50.000</td>
                <td>50.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>100.000</td>
                <td>201 (Non Likuid : Emas perhiasan)</td>
                <td>Alamat 10</td>
                <td>1.000.000</td>
                <td class="sticky-action-col text-center">
                  <a
                    href="#"
                    class="text-secondary me-2 edit"
                    data-bs-toggle="modal"
                    data-bs-target="#form1500Modal"
                    ><i class="fas fa-edit"></i></a
                  ><a href="#" class="text-danger delete"
                    ><i class="fas fa-trash-alt"></i
                  ></a>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th colspan="7" style="text-align: right">Total:</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
              <tr>
                <th colspan="7" style="text-align: right">Total CBS:</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
              <tr>
                <th colspan="7" style="text-align: right">Selisih:</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
      <!-- Table -->

      <script>
        $(document).ready(function () {
          $("#datatables").DataTable({
            scrollX: true,
            responsive: false,
            pageLength: 15,
            lengthChange: false,
            fixedColumns: {
              rightColumns: 1,
            },
            columnDefs: [
              {
                targets: -1, // Target the last column (Aksi)
                orderable: false, // Disable sorting for the Aksi column
              },
            ],
            language: {
              zeroRecords: "Tidak ada data yang ditemukan",
              info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
              infoEmpty: "Menampilkan 0 sampai 0 dari 0 entri",
              infoFiltered: "(difilter dari total _MAX_ entri)",
              search: "Cari:",
              paginate: {
                first: "Pertama",
                last: "Terakhir",
                next: "Berikutnya",
                previous: "Sebelumnya",
              },
            },
            footerCallback: function (row, data, start, end, display) {
              var api = this.api();

              // Fungsi parsing angka (hilangkan koma/karakter non-angka)
              var intVal = function (i) {
                return typeof i === "string"
                  ? i.replace(/[^0-9.-]/g, "") * 1
                  : typeof i === "number"
                  ? i
                  : 0;
              };

              // Kolom yang akan dijumlahkan:
              // Indeks 9: Per Posisi Laporan - Saldo Pokok
              // Indeks 13: Per Posisi Laporan - Tunggakan Bunga
              var colsToSum = [9, 13];

              colsToSum.forEach(function (colIdx) {
                var total = api
                  .column(colIdx, { search: "applied" })
                  .data()
                  .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                  }, 0);

                // Update footer dengan format angka yang sesuai
                $(api.column(colIdx).footer()).html(total.toLocaleString());
              });
            },
          });
        });

        // Function to format numbers with thousand separators
        function formatNumber(input) {
          let value = input.value.replace(/\D/g, "");
          if (value) {
            input.value = new Intl.NumberFormat("id-ID").format(value);
          }
        }

        // Apply number formatting to numeric inputs
        document.addEventListener("DOMContentLoaded", function () {
          document.querySelectorAll('input[type="text"]').forEach((input) => {
            // Check if input likely contains numbers (nominal, saldo, nilai, etc.)
            if (
              input.id &&
              (input.id.includes("nominal") ||
                input.id.includes("saldo") ||
                input.id.includes("nilai") ||
                input.id.includes("pokok") ||
                input.id.includes("bunga"))
            ) {
              input.classList.add("number-input");
              formatNumber(input);

              input.addEventListener("blur", function () {
                formatNumber(this);
              });
              input.addEventListener("focus", function () {
                this.value = this.value.replace(/\D/g, "");
              });
            }
          });
        });

        // Function to filter by Sandi Kantor
        function filterKantor() {
          var selected = document.getElementById("kantorFilter").value;
          var rows = document.querySelectorAll("tbody tr");

          rows.forEach(function (row) {
            if (selected === "all") {
              row.style.display = "";
            } else {
              var firstCell = row.querySelector("td:first-child");
              if (firstCell && firstCell.textContent.trim() === selected) {
                row.style.display = "";
              } else {
                row.style.display = "none";
              }
            }
          });
        }

        document.addEventListener("click", function (e) {
          if (e.target.closest(".tambah")) {
            e.preventDefault();
            const form = document.querySelector("#form1500Modal form");
            form.reset();
          }

          if (e.target.closest(".edit")) {
            e.preventDefault();
            const row = e.target.closest("tr");
            const cells = row.querySelectorAll("td");

            // Data Utama (kolom 0-6)
            document.getElementById("sandi_kantor").value =
              cells[0].textContent.trim();
            document.getElementById("id_pihak_lawan").value =
              cells[1].textContent.trim();
            document.getElementById("no_rekening").value =
              cells[2].textContent.trim();
            document.getElementById("jenis").value =
              cells[3].textContent.trim();
            document.getElementById("gol_debitur").value =
              cells[4].textContent.trim();
            document.getElementById("hubungan_bank").value =
              cells[5].textContent.trim();
            document.getElementById("tgl_hapus_buku").value =
              cells[6].textContent.trim();

            // Saldo Pokok (kolom 7-9) - remove formatting for editing
            document.getElementById("saldo_pokok_hapus").value =
              cells[7].textContent.trim().replace(/\D/g, "");
            document.getElementById("saldo_pokok_tertagih").value =
              cells[8].textContent.trim().replace(/\D/g, "");
            document.getElementById("saldo_pokok_laporan").value =
              cells[9].textContent.trim().replace(/\D/g, "");

            // Tunggakan Bunga (kolom 10-13) - remove formatting for editing
            document.getElementById("tunggakan_hapus").value =
              cells[10].textContent.trim().replace(/\D/g, "");
            document.getElementById("tunggakan_tertagih").value =
              cells[11].textContent.trim().replace(/\D/g, "");
            document.getElementById("tunggakan_tambahan").value =
              cells[12].textContent.trim().replace(/\D/g, "");
            document.getElementById("tunggakan_laporan").value =
              cells[13].textContent.trim().replace(/\D/g, "");

            // Agunan (kolom 14-16)
            document.getElementById("agunan_jenis").value =
              cells[14].textContent.trim();
            document.getElementById("agunan_alamat").value =
              cells[15].textContent.trim();
            document.getElementById("agunan_nilai").value =
              cells[16].textContent.trim().replace(/\D/g, "");
          }

          if (e.target.closest(".delete")) {
            e.preventDefault();
            const row = e.target.closest("tr");
            const confirmDelete = confirm(
              "Apakah Anda yakin ingin menghapus data ini?"
            );
            if (confirmDelete) {
              row.remove();
              // Refresh DataTable untuk update total
              $("#datatables").DataTable().draw();
            }
          }
        });
      </script>
      {% include 'lapbul_app/footer.html' %}
    </div>
  </main>
</div>
