{% include 'lapbul_app/header.html' %}
<style>
/* Define the sticky column styles */
.sticky-action-col {
    position: sticky;
    right: 0;
    background-color: rgba(255, 255, 255, 0.95) !important;
    z-index: 5;
    box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    text-align: center;
    min-width: 120px; 
}

/* CSS for form alignment and styling */
.form-container {
    display: flex;
    justify-content: center;
}
.table-responsive {
    max-width: 1200px;
    margin: 0 auto;
}

/* CSS untuk center kolom tertentu */
table td:nth-child(1),
table th:nth-child(1) {
    text-align: center;
    vertical-align: middle;
}

.form-select.w-auto {
    max-width: fit-content;
}
</style>

<div id="layoutSidenav_content">
  <main>
    <div class="container-fluid px-4">
      <h5 class="mt-4">Form 1300 - Daftar Simpanan dari Bank Lain</h5>
      <hr />
      <div class="d-flex justify-content-between">
        <a href="{% url 'lapbul_app:lapbul' %}" class="btn btn-secondary">Kembali</a>
        <!-- <button type="button" class="btn btn-secondary tambah" data-bs-toggle="modal" data-bs-target="#form1300Modal">Tambah</button> -->
      </div>
      <br />

      <!-- <div class="mb-3 d-flex align-items-center gap-2">
        <label for="sandiFilter" class="form-label mb-0">Filter Sandi Kantor:</label>
        <select id="sandiFilter" class="form-select form-select-sm w-auto" onchange="filterSandiKantor()">
          <option value="all">Semua</option>
          <option value="001">001</option>
          <option value="002">002</option>
        </select>
      </div> -->

      <!-- Modal -->
      <div
        class="modal fade"
        id="form1300Modal"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="form1300ModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header bg-secondary">
              <h6 class="modal-title text-white" id="form1300ModalLabel">
                Form Data Simpanan dari Bank Lain
              </h6>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="row g-3">
                  <!-- Form Inputs (17 fields) -->
                  <div class="col-md-4">
                    <label class="form-label">Sandi Kantor</label
                    ><input
                      type="text"
                      class="form-control"
                      id="sandi_kantor"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">ID Pihak Lawan</label
                    ><input
                      type="text"
                      class="form-control"
                      id="id_pihak_lawan"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Nomor Rekening</label
                    ><input type="text" class="form-control" id="no_rekening" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Jenis Bank</label
                    ><input type="text" class="form-control" id="jenis_bank" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Sandi Bank</label
                    ><input type="text" class="form-control" id="sandi_bank" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Lokasi Bank</label
                    ><input type="text" class="form-control" id="lokasi_bank" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Jenis</label
                    ><input type="text" class="form-control" id="jenis" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Hubungan dengan Bank</label
                    ><input type="text" class="form-control" id="hub_bank" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Jangka Waktu</label
                    ><input
                      type="text"
                      class="form-control"
                      id="jangka_waktu"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Tanggal Mulai</label
                    ><input
                      type="text"
                      class="form-control"
                      id="tgl_mulai"
                      placeholder="YYYYMMDD"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Tanggal Jatuh Tempo</label
                    ><input
                      type="text"
                      class="form-control"
                      id="tgl_jatuh"
                      placeholder="YYYYMMDD"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Suku Bunga</label
                    ><input type="text" class="form-control" id="suku_bunga" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Nominal</label
                    ><input type="text" class="form-control" id="nominal" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Nominal Diblokir/Dijaminkan</label
                    ><input
                      type="text"
                      class="form-control"
                      id="nominal_blokir"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Alasan Diblokir</label
                    ><input
                      type="text"
                      class="form-control"
                      id="alasan_blokir"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label"
                      >Transaksi Belum Diamortisasi</label
                    ><input
                      type="text"
                      class="form-control"
                      id="biaya_transaksi"
                    />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Jumlah</label
                    ><input type="text" class="form-control" id="jumlah" />
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Tutup
              </button>
              <button type="button" class="btn btn-primary">Simpan</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="form-container">
      <div class="table-responsive">
      <table id="datatables" class="table table-bordered table-sm nowrap w-100">
        <thead class="table-light text-center">
          <tr>
            <th class="text-center">Sandi Kantor</th>
            <th class="text-center">ID Pihak Lawan</th>
            <th class="text-center">Nomor Rekening</th>
            <th class="text-center">Jenis Bank</th>
            <th class="text-center">Sandi Bank</th>
            <th class="text-center">Lokasi Bank</th>
            <th class="text-center">Jenis</th>
            <th class="text-center">Hubungan dengan Bank</th>
            <th class="text-center">Tanggal Mulai</th>
            <th class="text-center">Tanggal Jatuh Tempo</th>
            <th class="text-center">Suku Bunga</th>
            <th class="text-center">Nominal</th>
            <th class="text-center">Nominal yang Diblokir/Dijaminkan</th>
            <th class="text-center">Alasan Diblokir</th>
            <th class="text-center">Transaksi Belum Diamortisasi</th>
            <th class="text-center">Jumlah</th>
            <th class="sticky-action-col text-center">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <!-- Semua data dummy tetap dipertahankan -->
          <tr>
            <td>001</td>
            <td>CIF1</td>
            <td>Rekening 1</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>02 (Deposito)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.50</td>
            <td>200000</td>
            <td>10000</td>
            <td>01 (Escrow Account)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF2</td>
            <td>Rekening 2</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>01 (Tabungan)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.56</td>
            <td>200000</td>
            <td>10000</td>
            <td>02 (Cash Collateral)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF3</td>
            <td>Rekening 3</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>02 (Deposito)</td>
            <td>12 (Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.57</td>
            <td>200000</td>
            <td>10000</td>
            <td>99 (Alasan Diblokir Lainnya)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <!-- Lanjutkan semua baris CIF4 s/d CIF9 seperti sebelumnya -->
          <tr>
            <td>001</td>
            <td>CIF4</td>
            <td>Rekening 4</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>01 (Tabungan)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.58</td>
            <td>200000</td>
            <td>10000</td>
            <td>01 (Escrow Account)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF5</td>
            <td>Rekening 5</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>02 (Deposito)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.59</td>
            <td>200000</td>
            <td>10000</td>
            <td>02 (Cash Collateral)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF6</td>
            <td>Rekening 6</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>01 (Tabungan)</td>
            <td>12 (Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.60</td>
            <td>200000</td>
            <td>10000</td>
            <td>99 (Alasan Diblokir Lainnya)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF7</td>
            <td>Rekening 7</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>02 (Deposito)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.61</td>
            <td>200000</td>
            <td>10000</td>
            <td>01 (Escrow Account)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF8</td>
            <td>Rekening 8</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>01 (Tabungan)</td>
            <td>20 (Tidak Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.62</td>
            <td>200000</td>
            <td>10000</td>
            <td>02 (Cash Collateral)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
          <tr>
            <td>001</td>
            <td>CIF9</td>
            <td>Rekening 9</td>
            <td>600 (BPR Konvensional)</td>
            <td>600005 (PT BPR Narwastu Mikro Perkasa)</td>
            <td>0102 (Kab. Bekasi)</td>
            <td>02 (Deposito)</td>
            <td>12 (Terkait)</td>
            <td>2018-01-01</td>
            <td>2022-12-31</td>
            <td>5.63</td>
            <td>200000</td>
            <td>10000</td>
            <td>99 (Alasan Diblokir Lainnya)</td>
            <td>100000</td>
            <td>100000</td>
            <td class="sticky-action-col">
              <a
                href="#"
                class="text-secondary me-1 edit"
                data-bs-toggle="modal"
                data-bs-target="#form1300Modal"
                ><i class="fas fa-edit"></i
              ></a>
              <a href="#" class="text-danger delete"
                ><i class="fas fa-trash-alt"></i
              ></a>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th colspan="11" style="text-align: right">Total:</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
          <tr>
            <th colspan="11" style="text-align: right">Total CBS:</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
          <tr>
            <th colspan="11" style="text-align: right">Selisih Jumlah CBS dengan lapbul:</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
        </tfoot>
      </table>
      </div>
      </div>
    </div>
  </main>
</div>

<script>
  $(document).ready(function () {
    $("#datatables").DataTable({
      scrollX: true,
      responsive: true,
      pageLength: 15,
      lengthChange: false,
      columnDefs: [
        {
          targets: -1, // Last column (Aksi)
          width: "120px",
          orderable: false,
          responsive: false
        },
            {
                targets: "_all", 
                render: function (data, type, row) {
                    if (!isNaN(data) && data !== "" && data !== null) {
                        return Number(data).toLocaleString("id-ID");
                    }
                    return data;
                }
            }
      ],
      language: {
        zeroRecords: "Tidak ada data yang ditemukan",
        info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
        infoEmpty: "Menampilkan 0 sampai 0 dari 0 entri",
        infoFiltered: "(difilter dari total _MAX_ entri)",
        search: "Cari:",
        paginate: {
          first: "Pertama",
          last: "Terakhir",
          next: "Berikutnya",
          previous: "Sebelumnya",
        },
      },
      footerCallback: function (row, data, start, end, display) {
        var api = this.api();
        var intVal = function (i) {
          return typeof i === "string"
            ? i.replace(/[^0-9.-]/g, "") * 1
            : typeof i === "number"
            ? i
            : 0;
        };
        var colsToSum = [11, 12, 14, 15];
        colsToSum.forEach(function (colIdx) {
          var total = api
            .column(colIdx, { search: "applied" })
            .data()
            .reduce(function (a, b) {
              return intVal(a) + intVal(b);
            }, 0);
          $(api.column(colIdx).footer()).html(total.toLocaleString());
        });
      },
    });
  });

  document.addEventListener("click", function (e) {
    if (e.target.closest(".tambah")) {
      e.preventDefault();
      document.querySelector("#form1300Modal form").reset();
    }
    if (e.target.closest(".edit")) {
      e.preventDefault();
      const row = e.target.closest("tr");
      const cells = row.querySelectorAll("td");
      document.getElementById("sandi_kantor").value = cells[0].textContent;
      document.getElementById("id_pihak_lawan").value = cells[1].textContent;
      document.getElementById("no_rekening").value = cells[2].textContent;
      document.getElementById("jenis_bank").value = cells[3].textContent;
      document.getElementById("sandi_bank").value = cells[4].textContent;
      document.getElementById("lokasi_bank").value = cells[5].textContent;
      document.getElementById("jenis").value = cells[6].textContent;
      document.getElementById("hub_bank").value = cells[7].textContent;
      document.getElementById("jangka_waktu").value = cells[8].textContent;
      document.getElementById("tgl_mulai").value = cells[9].textContent;
      document.getElementById("tgl_jatuh").value = cells[10].textContent;
      document.getElementById("suku_bunga").value = cells[11].textContent;
      document.getElementById("nominal").value = cells[12].textContent;
      document.getElementById("nominal_blokir").value = cells[13].textContent;
      document.getElementById("alasan_blokir").value = cells[14].textContent;
      document.getElementById("biaya_transaksi").value = cells[15].textContent;
      document.getElementById("jumlah").value = cells[16].textContent;
    }
    if (e.target.closest(".delete")) {
      e.preventDefault();
      if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
        e.target.closest("tr").remove();
      }
    }
  });
</script>

{% include 'lapbul_app/footer.html' %}
